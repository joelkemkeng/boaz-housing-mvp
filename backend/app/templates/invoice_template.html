
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facture Proforma</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #fff;
            color: #333;
            font-size: 12px;
            line-height: 1.6;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
        }

        .invoice-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background-color: #fff;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .company-details p {
            margin: 2px 0;
            font-size: 13px;
        }

        .invoice-title-section {
            text-align: right;
        }

        .invoice-title {
            font-size: 38px;
            font-weight: 700;
            color: #212529;
            margin: 0;
        }
        
        .invoice-title-section p {
            margin: 5px 0 0;
            font-size: 14px;
        }
        
        .details-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            gap: 20px;
        }

        .billing-info, .customer-info {
            flex-basis: 48%;
        }

        .billing-info p, .customer-info p {
            margin: 4px 0;
            font-size: 12px;
        }

        .billing-info strong.block-title, .customer-info strong.block-title {
            font-size: 15px;
            display: block;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .orange-separator {
            border: 0;
            height: 4px;
            background-color: #f39c12;
            margin: 20px 0 30px 0;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .invoice-table th, .invoice-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .invoice-table thead th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
            font-size: 13px;
        }
        
        .text-right { text-align: right; }
        .text-center { text-align: center; }

        .totals-and-footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 20px;
        }

        .notes-and-terms {
            flex-basis: 50%;
        }
        
        .totals-section {
            flex-basis: 45%;
        }

        .totals-table {
            width: 100%;
        }

        .totals-table td {
            padding: 12px 15px;
            font-size: 14px;
        }
        
        .totals-table tr.total-ttc td {
            font-weight: 700;
            font-size: 16px;
            background-color: #f8f9fa;
            border-top: 2px solid #ced4da;
        }
        
        .ps-note {
            font-weight: 600;
            color: #333;
            text-align: center;
            padding: 10px;
            border: 1px dashed #ccc;
            margin-bottom: 20px;
            font-size: 13px;
        }
        
        .terms {
            font-size: 10px;
            color: #6c757d;
            text-align: justify;
        }

        .signature-section {
            margin-top: 40px;
            text-align: right;
        }
        
        .signature-box {
            display: inline-block;
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid #ccc;
            width: 220px;
        }
        
        .signature-box p {
             margin: 0;
             font-size: 13px;
             font-weight: bold;
        }

        @media print {
            body { margin: 0; padding: 0; }
            .invoice-container { box-shadow: none; border: none; }
        }
    </style>
</head>
<body>
    <div class="invoice-container" id="invoice">
        <header class="invoice-header">
            <div class="company-details">
                <p><strong>Boaz Study Cameroun SAS</strong></p>
                <p>Yaoundé Total Ecole de Police - Tel: (+237) 658 870 473</p>
                <p>389 Rue Toyota Bonapriso, B.P: 1230 Douala - Tel: (+237) 694 186 936</p>
                <p>Email: info@boaz-study.com | Web: www.boaz-study.com</p>
            </div>
            <div class="invoice-title-section">
                <h1 class="invoice-title">FACTURE</h1>
                <p>Date : <span id="invoice-date"></span></p>
                <p>N° : <span id="invoice-number"></span></p>
            </div>
        </header>

        <section class="details-section">
            <div class="billing-info">
                <strong class="block-title">Coordonnées Bancaires</strong>
                <p><strong>Payable à :</strong> BOAZ STUDY CAMEROUN</p>
                <div id="banks-info"></div>
            </div>
            <div class="customer-info">
                <strong class="block-title">Facturé à</strong>
                <p><strong id="customer-name"></strong></p>
                <p>Adresse: <span id="customer-address"></span></p>
                <p>Mail: <span id="customer-email"></span></p>
            </div>
        </section>

        <hr class="orange-separator">

        <table class="invoice-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th class="text-center">Qté</th>
                    <th class="text-right">Prix unitaire</th>
                    <th class="text-right">Montant</th>
                </tr>
            </thead>
            <tbody id="invoice-items">
            </tbody>
        </table>

        <div class="totals-and-footer">
            <div class="notes-and-terms">
                <p class="ps-note" id="invoice-notes"></p>
                <div class="terms">
                    <strong>Terms and conditions:</strong>
                    <p id="invoice-terms">This invoice will be payable no later than 30 days after receipt. Past due amounts are subject to a late fee of 10% per month, or the maximum amount permitted by law.</p>
                </div>
            </div>
            <div class="totals-section">
                <table class="totals-table">
                    <tbody>
                        <tr>
                            <td>Total HT</td>
                            <td class="text-right"><span id="total-ht"></span> FCFA</td>
                        </tr>
                        <tr class="total-ttc">
                            <td><strong>Total TTC</strong></td>
                            <td class="text-right"><strong><span id="total-ttc"></span> FCFA</strong></td>
                        </tr>
                    </tbody>
                </table>
                <div class="signature-section">
                   <div class="signature-box">
                        <p>Cachet de l'entreprise</p>
                   </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fonction pour formater les nombres avec des espaces
        function formatCurrency(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        // Fonction pour remplir les données de la facture
        function populateInvoice(data) {
            // Informations de base
            document.getElementById('invoice-date').textContent = data.date;
            document.getElementById('invoice-number').textContent = data.invoice_number || '';
            document.getElementById('customer-name').textContent = data.customer.name;
            document.getElementById('customer-address').textContent = data.customer.address;
            document.getElementById('customer-email').textContent = data.customer.email;
            document.getElementById('invoice-notes').textContent = data.notes || '';
            
            // Informations bancaires
            const banksInfo = document.getElementById('banks-info');
            data.banks.forEach((bank, index) => {
                const bankDiv = document.createElement('div');
                bankDiv.innerHTML = `
                    <p><strong>Banque :</strong> ${bank.bank_name}</p>
                    ${bank.iban ? `<p><strong>IBAN :</strong> ${bank.iban}</p>` : ''}
                    ${bank.swift_code ? `<p><strong>CODE SWIFT :</strong> ${bank.swift_code}</p>` : ''}
                    ${bank.account_number ? `<p><strong>N° Compte :</strong> ${bank.account_number}</p>` : ''}
                    ${index < data.banks.length - 1 ? '<hr style="border:0; border-top:1px solid #eee; margin:10px 0;">' : ''}
                `;
                banksInfo.appendChild(bankDiv);
            });

            // Articles
            const itemsTable = document.getElementById('invoice-items');
            data.items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.description}</td>
                    <td class="text-center">${item.quantity}</td>
                    <td class="text-right">${formatCurrency(item.unit_price)}</td>
                    <td class="text-right">${formatCurrency(item.amount)}</td>
                `;
                itemsTable.appendChild(row);
            });

            // Totaux
            document.getElementById('total-ht').textContent = formatCurrency(data.total_ht);
            document.getElementById('total-ttc').textContent = formatCurrency(data.total_ttc);
        }

        // Fonction pour générer le PDF
        function generatePDF(filename) {
            window.print();
        }
    </script>
</body>
</html>
    